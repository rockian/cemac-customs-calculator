<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CEMAC Customs Calculator</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
 --accent:#0f9d9a;--accent2:#0a6a81;--bg:#f4fbfc;--card:#fff;--muted:#64748b;
 --shadow:0 6px 20px rgba(12,48,64,0.12);
}
*{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;}
body{margin:0;background:linear-gradient(180deg,#ecfeff 0%,var(--bg) 100%);min-height:100vh;
 display:flex;align-items:center;justify-content:center;padding:24px}
.container{width:100%;max-width:1000px;padding:18px;display:grid;grid-template-columns:1fr 420px;gap:18px}
.card{background:var(--card);border-radius:14px;padding:16px;box-shadow:var(--shadow)}
h1{margin:0;font-size:20px}
p.lead{margin:0;color:var(--muted);font-size:13px}
label{font-size:13px;color:var(--muted);display:block;margin-bottom:4px}
input,select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef0;font-size:14px}
.btn{padding:9px 12px;border-radius:8px;border:0;font-weight:600;cursor:pointer}
.btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff}
.btn-ghost{background:transparent;border:1px solid #e6eef0;color:var(--accent2)}
.small{font-size:12px;color:var(--muted)}
#langToggle{position:absolute;top:16px;right:22px;display:flex;gap:8px}
#langToggle img{width:26px;height:18px;cursor:pointer;border:1px solid #dce7e8;border-radius:4px;transition:.2s}
#langToggle img:hover{transform:scale(1.1);box-shadow:0 0 6px rgba(0,0,0,.1)}
.line{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;border:1px solid #eef7f7;margin-top:4px}
.total{font-weight:700;color:var(--accent2)}
@media(max-width:980px){.container{grid-template-columns:1fr}}
</style>
</head>
<body>
<div id="langToggle">
 <img src="assets/flag-en.svg" alt="English" onclick="switchLang('en')" title="English">
 <img src="assets/flag-fr.svg" alt="Français" onclick="switchLang('fr')" title="Français">
</div>

<div class="container">
 <div>
  <div class="card">
    <h1 data-i18n="title"></h1>
    <p class="lead" data-i18n="subtitle"></p>
  </div>
  <div style="height:10px"></div>
  <div class="card">
    <label data-i18n="hs_lookup"></label>
    <input id="hsSearch" placeholder="e.g. methanol / ex: méthanol">
    <label data-i18n="product_name"></label>
    <input id="product" value="Methanol (Ethanol invoice)">
    <label data-i18n="cif_value"></label>
    <input id="cif" type="number" value="18050.76">
    <label data-i18n="currency"></label>
    <select id="currency"><option value="USD">USD</option><option value="XAF">XAF</option></select>
    <label data-i18n="exchange_rate"></label>
    <input id="fx" type="number" value="600">
    <label data-i18n="category"></label>
    <select id="category">
      <option value="5">5%</option>
      <option value="10">10%</option>
      <option value="20">20%</option>
      <option value="30">30%</option>
    </select>
    <label data-i18n="industrial_reduction"></label>
    <input id="industrialReduction" type="number" value="0">
    <div class="small">
      <label><input id="tci" type="checkbox" checked> <span data-i18n="tci"></span></label>
      <label><input id="tpc" type="checkbox" checked> <span data-i18n="tpc"></span></label>
      <label><input id="rs" type="checkbox" checked> <span data-i18n="rs"></span></label>
      <label><input id="vatEx" type="checkbox"> <span data-i18n="vat_exempt"></span></label>
    </div>
    <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn btn-primary" id="calcBtn" data-i18n="calculate"></button>
      <button class="btn btn-ghost" id="resetBtn" data-i18n="reset"></button>
      <button class="btn" id="copyBtn" data-i18n="copy"></button>
      <button class="btn" id="csvBtn" data-i18n="export_csv"></button>
    </div>
    <p class="small" data-i18n="note"></p>
  </div>
 </div>

 <div class="card">
   <div class="line"><span data-i18n="customs_duty"></span><span id="customsDuty">—</span></div>
   <div class="line"><span data-i18n="tci"></span><span id="tciAmt">—</span></div>
   <div class="line"><span data-i18n="tpc"></span><span id="tpcAmt">—</span></div>
   <div class="line"><span data-i18n="rs"></span><span id="rsAmt">—</span></div>
   <div class="line"><span data-i18n="vat"></span><span id="vatAmt">—</span></div>
   <div class="line total"><span data-i18n="total_duties"></span><span id="totalDuties">—</span></div>
   <div class="line total"><span data-i18n="landed_cost"></span><span id="landedCost">—</span></div>
 </div>
</div>

<script>
const DEFAULTS={TCI:0.01,TPC:0.004,RS:0.005,TVA:0.18};
let currentLang='en',translations={};

async function loadLang(lang){
 const res=await fetch(`translations/${lang}.json`);
 translations=await res.json();
 document.querySelectorAll('[data-i18n]').forEach(el=>{
   const key=el.getAttribute('data-i18n');
   if(translations[key]) el.textContent=translations[key];
 });
 document.documentElement.lang=lang;
 localStorage.setItem('lang',lang);
 currentLang=lang;
}
function switchLang(lang){loadLang(lang);}

window.addEventListener('DOMContentLoaded',()=>{
 const stored=localStorage.getItem('lang');
 const lang=stored|| (navigator.language.startsWith('fr')?'fr':'en');
 loadLang(lang);
 calculate();
});

function fmt(n){return isFinite(n)?new Intl.NumberFormat('en-US',{maximumFractionDigits:0}).format(Math.round(n)):'—';}

const cifInput=document.getElementById('cif'),
currency=document.getElementById('currency'),
fx=document.getElementById('fx'),
category=document.getElementById('category'),
indRed=document.getElementById('industrialReduction'),
tci=document.getElementById('tci'),tpc=document.getElementById('tpc'),rs=document.getElementById('rs'),vatEx=document.getElementById('vatEx');
const customsDutyEl=document.getElementById('customsDuty'),tciAmt=document.getElementById('tciAmt'),tpcAmt=document.getElementById('tpcAmt'),rsAmt=document.getElementById('rsAmt'),vatAmt=document.getElementById('vatAmt'),totalDuties=document.getElementById('totalDuties'),landedCost=document.getElementById('landedCost');

function calculate(){
 const cif=parseFloat(cifInput.value)||0; const fxv=parseFloat(fx.value)||1;
 const cifXaf=currency.value==='USD'?cif*fxv:cif;
 let duty=parseFloat(category.value)||0;
 const red=parseFloat(indRed.value)||0; duty=duty*(1-red/100);
 const d=cifXaf*duty/100; const tciA=tci.checked?cifXaf*DEFAULTS.TCI:0;
 const tpcA=tpc.checked?cifXaf*DEFAULTS.TPC:0; const rsA=rs.checked?cifXaf*DEFAULTS.RS:0;
 const vatBase=cifXaf+d+tciA+tpcA+rsA; const vat=vatEx.checked?0:vatBase*DEFAULTS.TVA;
 const total=d+tciA+tpcA+rsA+vat; const landed=cifXaf+total;
 customsDutyEl.textContent=fmt(d);tciAmt.textContent=fmt(tciA);
 tpcAmt.textContent=fmt(tpcA);rsAmt.textContent=fmt(rsA);
 vatAmt.textContent=fmt(vat);totalDuties.textContent=fmt(total);
 landedCost.textContent=fmt(landed);
}
document.querySelectorAll('input,select').forEach(el=>el.addEventListener('input',calculate));
document.getElementById('calcBtn').addEventListener('click',calculate);
document.getElementById('resetBtn').addEventListener('click',()=>{cifInput.value=18050.76;fx.value=600;category.value=5;indRed.value=0;tci.checked=tpc.checked=rs.checked=true;vatEx.checked=false;calculate();});
document.getElementById('copyBtn').addEventListener('click',()=>{navigator.clipboard.writeText(`Total: ${totalDuties.textContent} XAF`).then(()=>alert('Copied'))});
document.getElementById('csvBtn').addEventListener('click',()=>{const csv=`Field,Amount\nCustoms Duty,${customsDutyEl.textContent}\nTCI,${tciAmt.textContent}\nTPC,${tpcAmt.textContent}\nRS,${rsAmt.textContent}\nVAT,${vatAmt.textContent}\nTotal,${totalDuties.textContent}\nLanded Cost,${landedCost.textContent}`;const blob=new Blob([csv],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='customs.csv';a.click();});
</script>
</body>
</html>
